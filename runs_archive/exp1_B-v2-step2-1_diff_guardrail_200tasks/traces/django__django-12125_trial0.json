{
  "task_id": "django__django-12125",
  "trial_id": 0,
  "issue_text": null,
  "test_command": "git apply",
  "diff": "diff --git a/django/db/migrations/operations/fields.py b/django/db/migrations/operations/fields.py\nindex 1a2b3c4..5d6e7f8 100644\n--- a/django/db/migrations/operations/fields.py\n+++ b/django/db/migrations/operations/fields.py\n@@ -10,6 +10,7 @@\n from django.db import models\n from django.db.migrations.state import ModelState\n from django.db.migrations.operations.base import Operation\n+from django.utils.module_loading import import_string\n \n \n class AddField(Operation):\n@@ -20,7 +21,7 @@ class AddField(Operation):\n         self.model_name = model_name\n         self.name = name\n         self.field = field\n-        self.preserve_default = preserve_default\n+        self.preserve_default = preserve_default if isinstance(field, models.Field) else True\n \n     def state_forwards(self, app_label, state):\n         model_state = state.get_model(app_label, self.model_name)\n@@ -39,7 +40,7 @@ class AddField(Operation):\n             model_state.add_field(self.name, self.field)\n \n     def database_backwards(self, app_label, schema_editor, model_state):\n-        model_state.remove_field(self.name)\n+        model_state.remove_field(self.name, self.field.__class__.__name__)\n \n     def describe(self):\n         return \"Add field %s.%s\" % (self.model_name, self.name)\ndiff --git a/django/db/migrations/state.py b/django/db/migrations/state.py\nindex 5a6b7c8..9d0e1f2 100644\n--- a/django/db/migrations/state.py\n+++ b/django/db/migrations/state.py\n@@ -10,6 +10,7 @@\n from django.apps import apps\n from django.db import models\n from django.db.migrations.loader import MigrationLoader\n+from django.utils.module_loading import import_string\n \n \n class ModelState(object):\n@@ -100,7 +101,7 @@ class ModelState(object):\n                 field = field.clone()\n                 field.name = name\n                 field.attname = attname\n-                self.fields[name] = field\n+                self.fields[name] = (field, field.__class__.__name__)\n \n     def remove_field(self, name):\n         del self.fields[name]\n@@ -110,7 +111,7 @@ class ModelState(object):\n         \"\"\"\n         Removes a field from the model state.\n         \"\"\"\n-        del self.fields[name]\n+        del self.fields[name][0]\n \n     def get_fields(self):\n         \"\"\"",
  "stdout": "",
  "stderr": "Git Apply Failed: error: corrupt patch at line 60\n",
  "repo_commit": null,
  "docker_image": "swebench/sweb.eval.x86_64:latest",
  "model_config": null,
  "full_result": {
    "task_id": "django__django-12125",
    "trial_id": 0,
    "model": "Qwen/Qwen2.5-Coder-7B-Instruct",
    "prompt_hash": "f0b849a95dd3a364068864578f490f062ae6ec43b1f5cc7d1edfc9834fabd468",
    "diff": "diff --git a/django/db/migrations/operations/fields.py b/django/db/migrations/operations/fields.py\nindex 1a2b3c4..5d6e7f8 100644\n--- a/django/db/migrations/operations/fields.py\n+++ b/django/db/migrations/operations/fields.py\n@@ -10,6 +10,7 @@\n from django.db import models\n from django.db.migrations.state import ModelState\n from django.db.migrations.operations.base import Operation\n+from django.utils.module_loading import import_string\n \n \n class AddField(Operation):\n@@ -20,7 +21,7 @@ class AddField(Operation):\n         self.model_name = model_name\n         self.name = name\n         self.field = field\n-        self.preserve_default = preserve_default\n+        self.preserve_default = preserve_default if isinstance(field, models.Field) else True\n \n     def state_forwards(self, app_label, state):\n         model_state = state.get_model(app_label, self.model_name)\n@@ -39,7 +40,7 @@ class AddField(Operation):\n             model_state.add_field(self.name, self.field)\n \n     def database_backwards(self, app_label, schema_editor, model_state):\n-        model_state.remove_field(self.name)\n+        model_state.remove_field(self.name, self.field.__class__.__name__)\n \n     def describe(self):\n         return \"Add field %s.%s\" % (self.model_name, self.name)\ndiff --git a/django/db/migrations/state.py b/django/db/migrations/state.py\nindex 5a6b7c8..9d0e1f2 100644\n--- a/django/db/migrations/state.py\n+++ b/django/db/migrations/state.py\n@@ -10,6 +10,7 @@\n from django.apps import apps\n from django.db import models\n from django.db.migrations.loader import MigrationLoader\n+from django.utils.module_loading import import_string\n \n \n class ModelState(object):\n@@ -100,7 +101,7 @@ class ModelState(object):\n                 field = field.clone()\n                 field.name = name\n                 field.attname = attname\n-                self.fields[name] = field\n+                self.fields[name] = (field, field.__class__.__name__)\n \n     def remove_field(self, name):\n         del self.fields[name]\n@@ -110,7 +111,7 @@ class ModelState(object):\n         \"\"\"\n         Removes a field from the model state.\n         \"\"\"\n-        del self.fields[name]\n+        del self.fields[name][0]\n \n     def get_fields(self):\n         \"\"\"",
    "patch_lines_added": 6,
    "patch_lines_removed": 4,
    "files_changed": 2,
    "timestamp": "2026-02-12T22:48:58.230844",
    "seed": 42,
    "repo": "django/django",
    "base_commit": "89d41cba392b759732ba9f1db4ff29ed47da6a56",
    "taxonomy_version": "B-v2-step2-B",
    "gen_elapsed_sec": 5.712603807449341,
    "stage": "PATCH",
    "stdout": "",
    "stderr": "Git Apply Failed: error: corrupt patch at line 60\n",
    "returncode": 128,
    "timeout": false,
    "elapsed_sec": 0.5042731761932373,
    "test_command": "git apply",
    "success": false,
    "error_type": "PATCH_FAIL",
    "signature": "git_apply_corrupt_patch",
    "docker_image": "swebench/sweb.eval.x86_64:latest"
  }
}