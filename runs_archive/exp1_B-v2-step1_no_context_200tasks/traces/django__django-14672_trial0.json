{
  "task_id": "django__django-14672",
  "trial_id": 0,
  "issue_text": null,
  "test_command": "git apply",
  "diff": "diff --git a/django/db/models/fields/related_descriptors.py b/django/db/models/fields/related_descriptors.py\nindex 1a2b3c4..5d6e7f8 100644\n--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -100,6 +100,7 @@ class RelatedManager(models.Manager.from_queryset(RelatedQuerySet)):\n     def get_queryset(self):\n         return super().get_queryset().using(self.instance._state.db)\n \n+from django.utils.functional import cached_property\n+\n class ReverseManyToOneDescriptor(object):\n     \"\"\"\n     This class provides the interface for the API of many-to-one relationships\n@@ -110,6 +111,7 @@ class ReverseManyToOneDescriptor(object):\n     def __init__(self, field, instance):\n         self.field = field\n         self.instance = instance\n+        self._cached_through_fields = None\n \n     def __get__(self, instance, cls=None):\n         if instance is None:\n@@ -120,6 +122,10 @@ class ReverseManyToOneDescriptor(object):\n             return self.__class__(self.field, instance)\n         return self.field.get_cached_value(instance)\n \n+    @cached_property\n+    def through_fields(self):\n+        return make_hashable(self.field.through_fields)\n+\n     def __set__(self, instance, value):\n         if isinstance(value, QuerySet):\n             raise ValueError(\"Cannot set %s to a QuerySet\" % self.field.name)\n@@ -130,6 +136,7 @@ class ReverseManyToOneDescriptor(object):\n                 raise ValueError(\"Cannot assign %r: %s must be a %s.\" %\n                                  (value, self.field.name, self.field.related_model._meta.label))\n         self.field.set_cached_value(instance, value)\n+        self._cached_through_fields = None\n \n     def __delete__(self, instance):\n         self.field.delete_cached_value(instance)\n@@ -140,6 +147,7 @@ class ReverseManyToOneDescriptor(object):\n     def contribute_to_class(self, cls, name):\n         setattr(cls, name, self)\n         self.field.rel.set_reverse_attr(name)\n+        self._cached_through_fields = None\n \n     def get_queryset(self):\n         qs = self.field.related_model._default_manager.all()\n@@ -150,6 +158,7 @@ class ReverseManyToOneDescriptor(object):\n         qs = qs.filter(**{self.field.related_query_name() + '__pk': self.instance.pk})\n         return qs\n \n+    def _get_cache_name(self):\n+        return '_%s_cache' % self.field.name\n+\n     def get_cached_value(self, instance):\n-        return getattr(instance, '_' + self.field.name + '_cache', None)\n+        return getattr(instance, self._get_cache_name(), None)\n \n     def set_cached_value(self, instance, value):\n-        setattr(instance, '_' + self.field.name + '_cache', value)\n+        setattr(instance, self._get_cache_name(), value)\n \n     def delete_cached_value(self, instance):\n-        delattr(instance, '_' + self.field.name + '_cache')\n+        delattr(instance, self._get_cache_name())\n \n     def do_update(self, using=None):\n         if self.field.auto_created:\n@@ -160,6 +169,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: self.value})\n \n     def do_create(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.create(**{self.field.name: self.value})\n \n@@ -170,6 +180,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: self.value})\n \n     def do_delete(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -180,6 +191,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_clear(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -190,6 +202,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -200,6 +213,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_reorder(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -210,6 +224,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_index(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -220,6 +235,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -230,6 +246,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_indexes(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -240,6 +257,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -250,6 +268,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -260,6 +279,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -270,6 +290,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions_and_views(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -280,6 +301,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions_and_views_and_procedures(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -290,6 +312,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions_and_views_and_procedures_and_packages(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -300,6 +323,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None",
  "stdout": "",
  "stderr": "Git Apply Failed: error: corrupt patch at line 14\n",
  "repo_commit": null,
  "docker_image": "swebench/sweb.eval.x86_64:latest",
  "model_config": null,
  "full_result": {
    "task_id": "django__django-14672",
    "trial_id": 0,
    "model": "Qwen/Qwen2.5-Coder-7B-Instruct",
    "prompt_hash": "f2fa6df4a3076abaf5f64f72a726ec30e6e9151d01b1964d7a325cf14e287e99",
    "diff": "diff --git a/django/db/models/fields/related_descriptors.py b/django/db/models/fields/related_descriptors.py\nindex 1a2b3c4..5d6e7f8 100644\n--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -100,6 +100,7 @@ class RelatedManager(models.Manager.from_queryset(RelatedQuerySet)):\n     def get_queryset(self):\n         return super().get_queryset().using(self.instance._state.db)\n \n+from django.utils.functional import cached_property\n+\n class ReverseManyToOneDescriptor(object):\n     \"\"\"\n     This class provides the interface for the API of many-to-one relationships\n@@ -110,6 +111,7 @@ class ReverseManyToOneDescriptor(object):\n     def __init__(self, field, instance):\n         self.field = field\n         self.instance = instance\n+        self._cached_through_fields = None\n \n     def __get__(self, instance, cls=None):\n         if instance is None:\n@@ -120,6 +122,10 @@ class ReverseManyToOneDescriptor(object):\n             return self.__class__(self.field, instance)\n         return self.field.get_cached_value(instance)\n \n+    @cached_property\n+    def through_fields(self):\n+        return make_hashable(self.field.through_fields)\n+\n     def __set__(self, instance, value):\n         if isinstance(value, QuerySet):\n             raise ValueError(\"Cannot set %s to a QuerySet\" % self.field.name)\n@@ -130,6 +136,7 @@ class ReverseManyToOneDescriptor(object):\n                 raise ValueError(\"Cannot assign %r: %s must be a %s.\" %\n                                  (value, self.field.name, self.field.related_model._meta.label))\n         self.field.set_cached_value(instance, value)\n+        self._cached_through_fields = None\n \n     def __delete__(self, instance):\n         self.field.delete_cached_value(instance)\n@@ -140,6 +147,7 @@ class ReverseManyToOneDescriptor(object):\n     def contribute_to_class(self, cls, name):\n         setattr(cls, name, self)\n         self.field.rel.set_reverse_attr(name)\n+        self._cached_through_fields = None\n \n     def get_queryset(self):\n         qs = self.field.related_model._default_manager.all()\n@@ -150,6 +158,7 @@ class ReverseManyToOneDescriptor(object):\n         qs = qs.filter(**{self.field.related_query_name() + '__pk': self.instance.pk})\n         return qs\n \n+    def _get_cache_name(self):\n+        return '_%s_cache' % self.field.name\n+\n     def get_cached_value(self, instance):\n-        return getattr(instance, '_' + self.field.name + '_cache', None)\n+        return getattr(instance, self._get_cache_name(), None)\n \n     def set_cached_value(self, instance, value):\n-        setattr(instance, '_' + self.field.name + '_cache', value)\n+        setattr(instance, self._get_cache_name(), value)\n \n     def delete_cached_value(self, instance):\n-        delattr(instance, '_' + self.field.name + '_cache')\n+        delattr(instance, self._get_cache_name())\n \n     def do_update(self, using=None):\n         if self.field.auto_created:\n@@ -160,6 +169,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: self.value})\n \n     def do_create(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.create(**{self.field.name: self.value})\n \n@@ -170,6 +180,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: self.value})\n \n     def do_delete(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -180,6 +191,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_clear(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -190,6 +202,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -200,6 +213,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_reorder(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -210,6 +224,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_index(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -220,6 +235,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -230,6 +246,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_indexes(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -240,6 +257,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -250,6 +268,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -260,6 +279,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -270,6 +290,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions_and_views(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -280,6 +301,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions_and_views_and_procedures(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -290,6 +312,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n     def do_rebuild_constraints_and_indexes_and_triggers_and_functions_and_views_and_procedures_and_packages(self, using=None):\n+        self._cached_through_fields = None\n         if self.field.auto_created:\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None})\n \n@@ -300,6 +323,7 @@ class ReverseManyToOneDescriptor(object):\n             self.field.model.objects.filter(pk=self.instance.pk).update(**{self.field.name: None",
    "patch_lines_added": 29,
    "patch_lines_removed": 3,
    "files_changed": 1,
    "timestamp": "2026-02-12T16:02:35.455748",
    "seed": 42,
    "repo": "django/django",
    "base_commit": "00ea883ef56fb5e092cbe4a6f7ff2e7470886ac4",
    "taxonomy_version": "B-v2",
    "gen_elapsed_sec": 20.64551067352295,
    "stage": "PATCH",
    "stdout": "",
    "stderr": "Git Apply Failed: error: corrupt patch at line 14\n",
    "returncode": 128,
    "timeout": false,
    "elapsed_sec": 0.5221199989318848,
    "test_command": "git apply",
    "success": false,
    "error_type": "PATCH_FAIL",
    "signature": "git_apply_failed",
    "docker_image": "swebench/sweb.eval.x86_64:latest"
  }
}